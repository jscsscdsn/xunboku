function toggleIntro() {
  var showintro = $(".pIntroTxt").html();
  $(".pIntroTxt").html($("#hidden_intro").val());
  $("#hidden_intro").val(showintro);

}


$(".tabNav").delegate("li", "click", function (e) {
  $(".tabNav li").find("span").removeClass("cur");
  $(this).find("span").addClass("cur");
  var num = $(this).index();
  $("div.tabCon").hide().eq(num).show();

});

if ($("#juji")[0]) {
  var width = $("#juji").width() + 30;
  $("#juji2 .conBox ").css({
    width: width

  });
  var indexMenu2 = new iScroll("juji2", {
    hScroll: true,
    vScroll: false,
    bounce: false,
    momentum: true

  });
  $(window).on("resize", function () {
    $("#juji2 .conBox ").css({
      width: ""

    });
    var width = $("#juji").width() + 30;
    $("#juji2 .conBox ").css({
      width: width

    });
    indexMenu2.refresh();
    isShow();

  });

  function isShow() {
    var width1 = $("#juji").width();
    var width2 = document.documentElement.clientWidth;
    if (width2 < width1) {
      $("#juji2").removeClass("numListWid");
      $("#juji2").addClass("numListWid");

    } else {
      $("#juji2").removeClass("numListWid");

    }

  }
  isShow();
  $(function () {
    $(window).scroll(function () {
      var sign = $(".numListBox").offset().top;
      var x = $(this).scrollTop();
      if (x > sign && !$("#juji2").hasClass("fixBox")) {
        $("#juji2").addClass("fixBox");

      } else if (x < sign && $("#juji2").hasClass("fixBox")) {
        $("#juji2").removeClass("fixBox");

      }

    });

  });

}


function resizeImgCommon() {
  var arg = arguments[0] || "resize_list";
  var width = $("#" + arg).width();
  height = $("#" + arg).height();
  width = parseInt(width * .31999);
  height = parseInt(260 * (width / 195));
  $("#" + arg + " img").css({
    width: width,
    height: height

  });
  arg == "resize_list" && $("#" + arg + " a").css({
    width: width,
    height: height

  });

}

if ($("#resize_list").length) {
  resizeImgCommon();
  $(window).on("resize", function () {
    resizeImgCommon();

  });

}

if ($("#nav_menu")[0]) {
  var width = $(".subNav p").width() + 30;
  $("#nav_menu .con").css({
    width: width

  });
  var indexMenu = new iScroll("nav_menu", {
    hScroll: true,
    vScroll: false,
    bounce: true,
    momentum: true

  });
  $(window).on("resize", function () {
    $("#nav_menu .con").css({
      width: ""

    });
    var width = $(".subNav p").width() + 30;
    $("#nav_menu .con").css({
      width: width

    });
    indexMenu.refresh();

  });

  if ($("#nav_menu a.cur")[0]) {
    var screenWidth = $(".header").width();
    var left = $("#nav_menu a.cur").offset().left;
    var scrollLeft = parseInt(screenWidth - left);
    if (scrollLeft < 30) {
      indexMenu.scrollTo(-screenWidth);

    }

  }

}

if ($("#nav_mmenu")[0]) {
  var width = $(".subNav p").width() + 30;
  $("#nav_mmenu .con").css({
    width: width

  });
  var indexMenu = new iScroll("nav_mmenu", {
    hScroll: true,
    vScroll: false,
    bounce: true,
    momentum: true

  });
  $(window).on("resize",
    function () {
      $("#nav_mmenu .con").css({
        width: ""

      });
      var width = $(".subNav p").width() + 30;
      $("#nav_mmenu .con").css({
        width: width

      });
      indexMenu.refresh();

    });

  if ($("#nav_mmenu a.cur")[0]) {
    var screenWidth = $(".header").width();
    var left = $("#nav_mmenu a.cur").offset().left;
    var scrollLeft = parseInt(screenWidth - left);
    if (scrollLeft < 30) {
      indexMenu.scrollTo(-screenWidth);

    }

  }

}
if ($("#nav_mmmenu")[0]) {
  var width = $(".subNav p").width() + 30;
  $("#nav_mmmenu .con").css({
    width: width

  });
  var indexMenu = new iScroll("nav_mmmenu", {
    hScroll: true,
    vScroll: false,
    bounce: true,
    momentum: true

  });
  $(window).on("resize",
    function () {
      $("#nav_mmmenu .con").css({
        width: ""

      });
      var width = $(".subNav p").width() + 30;
      $("#nav_mmmenu .con").css({
        width: width

      });
      indexMenu.refresh();

    });

  if ($("#nav_mmmenu a.cur")[0]) {
    var screenWidth = $(".header").width();
    var left = $("#nav_mmmenu a.cur").offset().left;
    var scrollLeft = parseInt(screenWidth - left);
    if (scrollLeft < 30) {
      indexMenu.scrollTo(-screenWidth);

    }

  }

}

$(".aSearch")[0] && $(".aSearch").click(function (e) {
  $("#index_menu_box").hide();
  $(".index_menu_top").hide();
  $(".ulHotList").hide();
  $(".loginPop").hide();
  $("#ls_box").hide();
  $(".headRight a").removeClass("cur");
  if ($("#search_box").css("display") == "none") {
    $("html,body").css({
      "overflow-y": "hidden"

    });
    $(".aSearch").addClass("cur");
    $("#mask_box").show();
    $("#search_box").show();
    $("#hot_word_box").show();
    $(".searchTxt").focus();

  } else {
    searchM.addCurClass();
    $("html,body").css({
      "overflow-y": "auto"

    });
    $("#hot_word_box").hide();
    $("#search_box").hide();
    $("#mask_box").hide();

  }

});


$(".aUnLogin")[0] && $(".aUnLogin").click(function (e) {
  $("#index_menu_box").hide();
  $(".index_menu_top").hide();
  $(".ulHotList").hide();
  $(".loginPop").hide();
  $("#search_box").hide();
  $(".headRight a").removeClass("cur");
  if ($("#ls_box").css("display") == "none") {
    $("html,body").css({
      "overflow-y": "hidden"

    });
    $(".aUnLogin").addClass("cur");
    $("#ls_box").show();

  } else {
    searchM.addCurClass();
    $("html,body").css({
      "overflow-y": "auto"

    });
    $("#ls_box").hide();
    $("#hot_word_box").hide();
    $("#mask_box").hide();

  }

});


$(".aNav")[0] && $(".aNav").click(function () {
  if (!$(".searchForm")[0]) {
    $("#search_box").hide();

  }
  $(".ulHotList")[0] && $(".ulHotList").hide();
  $(".loginPop").hide();
  $(".headRight a").removeClass("cur");
  if ($(".index_menu_top")[0]) {
    $("#mask_box").hide();
    if ($(".index_menu_top").css("display") == "none") {
      $(".index_menu_top").show();
      $("#nav_menu .con").css({
        width: ""

      });
      $("#nav_mmenu .con").css({
        width: ""

      });
      $("#nav_mmmenu .con").css({
        width: ""

      });
      var width = $(".subNav p").width() + 30;
      $("#nav_menu .con").css({
        width: width

      });
      $("#nav_mmenu .con").css({
        width: width

      });
      $("#nav_mmmenu .con").css({
        width: width

      });
      indexMenu.refresh();

    } else {
      searchM.addCurClass();
      $(".index_menu_top").hide();

    }

  } else {
    if ($("#index_menu_box").css("display") == "none") {
      $("html,body").css({
        "overflow-y": "hidden"

      });
      $(".aNav").addClass("cur");
      $("#mask_box").show();
      $("#index_menu_box").show();

    } else {
      searchM.addCurClass();
      $("html,body").css({
        "overflow-y": "auto"

      });
      $("#index_menu_box").hide();
      $("#mask_box").hide();

    }

  }

});

if ($("#search_menu")[0]) {
  var width = $(".searchNav p").width() + 30;
  $("#search_menu .con").css({
    width: width

  });
  var searchMenu = new iScroll("search_menu", {
    hScroll: true,
    vScroll: false,
    bounce: true,
    momentum: true

  });
  $(window).on("resize", function () {
    $("#search_menu .con").css({
      width: ""

    });
    var width = $(".searchNav p").width() + 30;
    $("#search_menu .con").css({
      width: width

    });
    searchMenu.refresh();

  });
  if ($("#search_menu a.cur")[0]) {
    var screenWidth = $(".header").width();
    var leftWidth = $("#search_menu a.cur").offset().left;
    var aWidth = $("#search_menu a.cur").width();
    var scrollLeft = parseInt(screenWidth - leftWidth - aWidth);
    if (scrollLeft < 5) {
      searchMenu.scrollTo(-screenWidth);

    }

  }

}

var searchM = {
  isScrolled: 0,
  curIndex: false,
  init: function () {
    if (!$("#search_box")) {
      return;

    }
    var that = this;
    //that.getHotWord();
    //that.getHistory();
    //that.dealInput();
    //that.searchPage();
    //that.addHistory();
    //that.getCurIndex();
    //that.hideAll();
    $(".searchBtn")[0] && $(".searchBtn").click(function () {
      that.submitSearch();

    });

  },
  getCurIndex: function () {
    var that = this;
    if ($(".headRight")[0]) {
      $(".headRight a").each(function () {
        if ($(this).attr("class").indexOf("cur") !== -1) {
          that.curIndex = $(this).index();

        }

      });

    }

  },
  addCurClass: function () {
    this.curIndex && $($(".headRight a")[this.curIndex]).addClass("cur");

  },
  hideAll: function () {
    var that = this;
    $("#search_main")[0] && $(document).click(function (e) {
      if (e.target.id != "search_box" && e.target.id != "search_form" && e.target.className != "searchTxt" && e.target.parentNode.className != "clearSearchBtn") {
        $("#search_history_list").hide();

      }

    });
    $("#mask_box").click(function () {
      $(".headRight a").removeClass("cur");
      $("#hot_word_box").hide();
      !$("#search_main")[0] && $("#search_box").hide();
      $("#mask_box").hide();
      $(".loginPop").hide();
      $("#index_menu_box").hide();
      $(".index_menu_top").hide();
      $("html,body").css({
        "overflow-y": "auto"

      });
      that.addCurClass();

    });

  },
  searchPage: function () {
    if (!$("#search_main")[0]) {
      return;

    }
    this.bindScroll();

  },
  bindScroll: function () {
    var that = this;
    $(window).scroll(function () {
      var pageTotal = parseInt($("#page_more").attr("data-total"));
      var pageNow = parseInt($("#page_more").attr("data-page"));
      var scrollTop = $(this).scrollTop();
      var scrollHeight = $(".wrapper").height() - scrollTop - $(document).height();
      if (scrollHeight <= 30 && !that.isScrolled && pageTotal >= pageNow) {
        that.nextPage();

      }

    });
    return;

  },
  nextPage: function (ele) {
    var ele = $("#page_more"),
      that = this;
    that.isScrolled = 1;
    var _page = $(ele).attr("data-page");
    if (!_page) {
      return false;

    }
    $("#loading_more").show();
    var url = ele.attr("data-url");
    $.ajax({
      url: url,
      data: {
        page: _page,
        is_ajax: 1

      },
      type: "get",
      charset: "gb2312",
      success: function (json) {
        if (json) {
          var _json = eval("(" + json + ")");
          var _html = that.createHtml(_json["list"]);
          var pageTotal = _json["page_num"];
          $("#loading_more").hide();
          $("#data_list").append(_html);
          var pageNext = parseInt(_page) + 1;
          if (pageNext <= pageTotal) {
            $(ele).attr("data-page", pageNext);
            that.isScrolled = 0;

          }

        }

      }

    });

  },

  html2Escape: function (sHtml) {
    return sHtml.replace(/[<>&"]/g, function (c) {
      return {
        "<": "&lt;",
        ">": "&gt;",
        "&": "&amp;",
        '"': "&quot;"

      }[c];

    });

  }

};

searchM.init();

$(window).scroll(function () {
  var num = $(this).scrollTop();
  if (num > 100) {
    $(".fixedBtnList").show();

  } else {
    $(".fixedBtnList").hide();

  }

});

$(".aFeedBack").click(function () {
  var param = escape(window.location.href);
  var url = $(this).attr("href") + "?from=" + param;
  $(this).attr("href", url);

});

var sliderTimeout, timeOut = 2000,
  bodyWidth = 0,
  changeValue;

function setHeight() {
  $("#focusCon").css({
    'height': ''
  });
  changeValue = bodyWidth = document.body.clientWidth;
  var height = Math.round(bodyWidth * 227 / 480);
  $("#focusCon").css({
    'height': height
  });
  clearTimeout(sliderTimeout);
  sliderTimeout = setTimeout(autoPlay, timeOut)
}
window.onload = setHeight();
$(window).on('resize', function () {
  setHeight()
});
var focusConArr = $("#focusCon li"),
  focusTabArr = $("#focusTab i"),
  prevIndex = nextIndex = 0,
  focuscListLength = focusConArr.length,
  currentTime = 0,
  durationTime = 50,
  isFocusLoaded = false;
animateIng = false;

function foucsAnimate(prev, next, widthNum, className, durationTime, currentTime, changeValue) {
  clearTimeout(sliderTimeout);
  !isFocusLoaded && $("#focusCon img").each(function () {
    if ($(this).attr('data-src')) {
      $(this).attr('src', $(this).attr('data-src'));
      $(this).attr('data-src', '')
    }
    isFocusLoaded = true
  });
  $(focusConArr[prev]).css({
    "left": "0px"
  }).addClass(className);
  $(focusConArr[next]).css({
    "left": widthNum
  }).addClass(className);
  animateIng = true;

  function Run() {
    $(focusConArr[prev]).css({
      "left": Math.ceil(animateEaseIn(currentTime, 0, -changeValue, durationTime)) + "px"
    });
    $(focusConArr[next]).css({
      "left": Math.ceil(animateEaseIn(currentTime, changeValue, -changeValue, durationTime)) + "px"
    });
    if (currentTime < durationTime) {
      currentTime++;
      setTimeout(Run, 6.5)
    } else {
      $(focusConArr[prev]).removeClass(className);
      animateIng = false;
      currentTime = 0;
      sliderTimeout = setTimeout(autoPlay, timeOut);
      changeValue = Math.abs(changeValue)
    }
  }
  Run();
  $(focusTabArr[prev]).removeClass(className);
  $(focusTabArr[next]).addClass(className)
}

function autoPlay() {
  prevIndex = nextIndex;
  nextIndex++;
  if (nextIndex == focuscListLength) {
    nextIndex = 0
  }
  foucsAnimate(prevIndex, nextIndex, bodyWidth, "cur", durationTime, currentTime, changeValue)
}

function animateEaseIn(t, b, c, d) {
  return c * (t /= d) * t + b
}
var startTouchX = endTouchX = 0;
var moveY = 0;

function touchstart(event) {
  clearTimeout(sliderTimeout);
  startTouchX = event.touches[0].pageX;
  moveY = event.touches[0].pageY
}

function touchmove(event) {
  if (Math.abs(event.touches[0].pageY - moveY) < 8) {
    event.preventDefault()
  }
  endTouchX = event.touches[0].pageX
}

function touchend(event) {
  if (animateIng === false) {
    changeValue = Math.abs(changeValue);
    prevIndex = nextIndex;
    if (endTouchX > (startTouchX + 30)) {
      changeValue = -changeValue;
      nextIndex--;
      if (nextIndex == -1) {
        nextIndex = focuscListLength - 1
      }
      foucsAnimate(prevIndex, nextIndex, bodyWidth, "cur", durationTime, currentTime, changeValue)
    } else if ((endTouchX + 30) < startTouchX) {
      nextIndex++;
      if (nextIndex == focuscListLength) {
        nextIndex = 0
      }
      foucsAnimate(prevIndex, nextIndex, bodyWidth, "cur", durationTime, currentTime, changeValue)
    } else {
      sliderTimeout = setTimeout(autoPlay, timeOut)
    }
  }
  changeValue = Math.abs(changeValue)
}

$(function () {
  $("img").lazyload({
    effect: "fadeIn"
  });
  $(".week li").hover(function () {
    $(this).addClass("current").siblings().removeClass("current");
    $(".index-tab-con .tb_a").eq($(this).index()).show().siblings().hide();
  });

  function oooTab() {
    $(this).addClass("current").siblings().removeClass("current").parent().siblings().hide().siblings("." + $(this).attr("id")).show();
  }
  $(".tabt span,.tabt2 span").mouseover(oooTab);
  $(".tabt3 span").click(oooTab);
});
